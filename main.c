/* ************************************************************************** */
/*                                                                            */
/*                                                        :::      ::::::::   */
/*   main.c                                             :+:      :+:    :+:   */
/*                                                    +:+ +:+         +:+     */
/*   By: mmonahan <mmonahan@student.42.fr>          +#+  +:+       +#+        */
/*                                                +#+#+#+#+#+   +#+           */
/*   Created: 2019/09/02 16:27:34 by mmonahan          #+#    #+#             */
/*   Updated: 2019/09/10 20:49:42 by mmonahan         ###   ########.fr       */
/*                                                                            */
/* ************************************************************************** */

#include "filler.h"
#include <stdio.h>

int		fd; // для проверки, потом убрать!!!
int		check = 1; // активировать проверки, потом убрать

/*
**	Определяем номер игрока
*/
void	player_definition(t_player *player)
{
	char *str;

	get_next_line(0, &str);
	if (str[10] == '1')
	{
		player->first = 'O';
		player->last = 'o';
	}
	else if (str[10] == '2')
	{
		player->first = 'X';
		player->last = 'x';
	}

	if (check) // проверка на игрока
	{
		ft_putstr_fd("->player ", fd);
		ft_putnbr_fd(player->first == 'O' ? 1 : 2, fd);
		ft_putstr_fd("<-\n", fd);
	}
}

/*
**	Определяем размеры игрового поля
*/
void	plateau_definition(t_plateau *plateau)
{
	char *str;

	plateau->n = 0;
	plateau->x = 0;
	get_next_line(0, &str);
	str += 8;
	while (*str && *str != ' ')
	{
		if (ft_isdigit(*str))
			plateau->n = plateau->n * 10 + *str - '0';
		str++;
	}
	while (*str)
	{
		if (ft_isdigit(*str))
			plateau->x = plateau->x * 10 + *str - '0';
		str++;
	}

	if (check) // проверка на координаты
	{
		ft_putstr_fd("->по N - ", fd);
		ft_putnbr_fd(plateau->n, fd);
		ft_putstr_fd("<-\n->по X - ", fd);
		ft_putnbr_fd(plateau->x, fd);
		ft_putstr_fd("<-\n", fd);
	}
}

/*
**	Выделяем область памяти для карты
*/
void	creat_plateau(t_plateau *plt)
{
	int i;

	i = 0;
	plt->board = (char **)ft_memalloc(sizeof(char *) * plt->n + 1);
	plt->board[plt->n] = NULL;
	while (i < plt->n)
	{
		plt->board[i] = (char *)ft_memalloc(sizeof(char) * plt->x + 1);
		plt->board[i][plt->x] = '\0';
		i++;
	}

}
char	**creat_matrix(int row, int col)
{
	char **matrix;
	int i;

	i = 0;
	matrix = (char **)ft_memalloc(sizeof(char *) * row + 1);
	matrix[row] = NULL;
	while (i < row)
	{
		matrix[i] = (char *)ft_memalloc(sizeof(char) * col + 1);
		matrix[i][col] = '\0';
		i++;
	}
	return (matrix);
}
/*
$$$ exec p2 : [./mmonahan.filler]
Plateau 15 17:
    01234567890123456
000 .................
001 .................
002 .................
003 .................
004 .................
005 .................
006 .................
007 .................
008 ..O..............
009 .................
010 .................
011 .................
012 ..............X..
013 .................
014 .................
Piece 2 1:
*
*
*/

/*
$$$ exec p2 : [./mmonahan.filler]
Plateau 100 99:
    012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678
000 ...................................................................................................
001 ...................................................................................................
002 ...................................................................................................
003 ...................................................................................................
004 ...................................................................................................
005 ...................................................................................................
006 ...................................................................................................
007 ...................................................................................................
008 ...................................................................................................
009 ...................................................................................................
010 ...................................................................................................
011 ...................................................................................................
012 ...................................................................................................
013 ...................................................................................................
014 ...................................................................................................
015 ...................................................................................................
016 ...................................................................................................
017 ...................................................................................................
018 ...................................................................................................
019 ...................................................................................................
020 ...................................................................................................
021 ...................................................................................................
022 ...................................................................................................
023 ...................................................................................................
024 ...................................................................................................
025 ...................................................................................................
026 ...................................................................................................
027 ...................................................................................................
028 ...................................................................................................
029 ..............................X....................................................................
030 ...................................................................................................
031 ...................................................................................................
032 ...................................................................................................
033 ...................................................................................................
034 ...................................................................................................
035 ...................................................................................................
036 ...................................................................................................
037 ...................................................................................................
038 ...................................................................................................
039 ...................................................................................................
040 ...................................................................................................
041 ...................................................................................................
042 ...................................................................................................
043 ...................................................................................................
044 ...................................................................................................
045 ...................................................................................................
046 ...................................................................................................
047 ...................................................................................................
048 ...................................................................................................
049 ...................................................................................................
050 ...................................................................................................
051 ...................................................................................................
052 ...................................................................................................
053 ...................................................................................................
054 ...................................................................................................
055 ...................................................................................................
056 ...................................................................................................
057 ...................................................................................................
058 ...................................................................................................
059 ...................................................................................................
060 ...................................................................................................
061 ...................................................................................................
062 ...................................................................................................
063 ...................................................................................................
064 ...................................................................................................
065 ...................................................................................................
066 ...................................................................................................
067 ...................................................................................................
068 ...................................................................................................
069 ......................................................................O............................
070 ...................................................................................................
071 ...................................................................................................
072 ...................................................................................................
073 ...................................................................................................
074 ...................................................................................................
075 ...................................................................................................
076 ...................................................................................................
077 ...................................................................................................
078 ...................................................................................................
079 ...................................................................................................
080 ...................................................................................................
081 ...................................................................................................
082 ...................................................................................................
083 ...................................................................................................
084 ...................................................................................................
085 ...................................................................................................
086 ...................................................................................................
087 ...................................................................................................
088 ...................................................................................................
089 ...................................................................................................
090 ...................................................................................................
091 ...................................................................................................
092 ...................................................................................................
093 ...................................................................................................
094 ...................................................................................................
095 ...................................................................................................
096 ...................................................................................................
097 ...................................................................................................
098 ...................................................................................................
099 ...................................................................................................
Piece 16 14:
..............
..............
..............
..............
..............
..............
..............
.**...........
..............
..............
..............
..............
..............
..............
..............
..............
 */

/*
**	Заполняем карту (ДОДЕЛАТЬ!!!)
*/
void	aggregate_plateau(t_plateau *plateau)
{
	char	*str;
	int		i;
	int		j;

	str = ft_memalloc(1);
	i = 0;
	j = 0;

	get_next_line(0, &str);// пропускаем строку с номерами столбцов
	while (j < plateau->n)
	{
		get_next_line(0, &str);
		while (i < plateau->x)
		{
			plateau->board[j][i] = str[i + 4];
			i++;
		}
		i = 0;
		j++;
	}
}

/*
**	Выводим в файл test.txt карту
*/
void	print_plateau(t_plateau *plateau)
{
	//вывод проверка plt.board

	int col;
	int row;

	col = 0;
	row = 0;
	ft_putstr_fd("---+------------+----------+---\n", fd);
	while (row < plateau->n)
	{
		while (col < plateau->x)
		{
			ft_putchar_fd(plateau->board[row][col], fd);
			col++;
		}
		ft_putstr_fd("\n", fd);
		col = 0;
		row++;
	}
	ft_putstr_fd("---+------------+----------+---\n", fd);
}

/*
**	Определяем размеры размер фигуры
*/
int piece_definition(t_piece pc, char *str)
{

	return (0);
}

/*
**	Галвная
*/
int main()
{
	if (1)
	{
		t_player 	player;
		t_plateau	plateau;
		int			i;
		char		*str;
		//int			fd; //пока есть глобальная, но потом она уйдет она для проверки
		char		*stop = "qq";

		str = "abc";
		player.first = 'X';
		player.last = 'x';

		fd = open("test.txt", O_WRONLY);
		player_definition(&player); // Читаем номер игрока
		plateau_definition(&plateau);//, str); //читаем размер поля и малочим его
		//creat_plateau(&plateau); // выделяем память под карту в board.board
		plateau.board = creat_matrix(plateau.n, plateau.x);
		aggregate_plateau(&plateau); //заполнение карты

		if (check)
			print_plateau(&plateau); //вывод карты

		while (1)
		{

			get_next_line(0, &str);

		//	i = ft_strlen(str);
			if (!ft_strcmp(str, stop))
				return (1);

		//	write(fd, str, i);
		//	write(fd, "\n", 1);
			write(1, "0 0\n", 4);
		}
		close(fd);
	}
	return 0;
}
